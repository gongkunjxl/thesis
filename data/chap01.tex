\chapter{引言}
随着计算机互联网技术的飞速发展，网络规模不断扩大，各行业中应用业务量和数据都呈现爆炸式的增长，如何存储和高效处理各种应用产生的海量数据已成为各大互联网公司面
临的一个巨大挑战。继分布式计算、网格计算和并行计算后，一种全新的将整个互联网资源聚合起来处理数据的计算模式应运而生: 云计算~\cite{Hayes2008Cloud}。这种按需付费、共享资源、统一管理、可伸缩、可度量的计算模式发展迅猛，已经给信息产业带来了巨大的影响。

然而，云计算往往是以虚拟机作为云主机进行构建，将用户对资源的需求和软件服务虚拟化成虚拟机资源，然后进行虚拟机创建、操作系统安装以及应用部署。这种虚拟化方式需要巨大的
虚拟化开销，并且不同的虚拟机操作系统不同，其应用跨平台性较差。近年来，容器逐步取代虚拟机技术成为云计算的主流技术，给云计算带来新的革命，尤其是以Docker~\cite{2015Docker}为代表的容器虚拟化技术获得了飞速的发展，基于Docker技术的容器云如雨后春笋般出现。云平台以其快速的应用部署、启动、交付以及优异的跨平台性能迅速占领市场。

与传统的云计算模式相似，一个强大且高效的资源调度系统对集群性能和资源利用率起到决定性作用，Docker虚拟化作为一种新型的容器云技术解决方案，其容器编排能力还存在很多不足。
Google开发的Kubernetes是容器云中容器调度系统的优秀代表，其轻量开源和强大的编排能力深受深受人们好评，但是其调度算法单一和资源利用不均衡性成为制约其性能的重要因素，
本文在深入研究Kubernetes调度核心后，针对其调度性能不足，设计并实现了一种新的调度方案，在基于开源OpenShift Origin和实验室项目paldin storage构建的大数据存储与处理的容器云平台Paladin上设计并实现新的调度方案，极大提升了大数据处理场景下多种计算框架容器应用的性能。

\section{云计算调度概述}
云计算是当前较为普遍的一种分布式计算方式，通过将计算资源聚合成资源共享池对外提供按需付费、弹性计算的能力，对当前的计算机技术带来巨大的影响。其服务资源池有基础设施即服务(IaaS，Infrastructure as a Service)、平台即服务(PaaS，Platform as a Service)以及软件即服务(SaaS，Software as a Service)三种服务模式。其计算类型根据用户对象的不同可以划分为公有云、私有云和混合云，典型的公有云有Google Gmail、Amazon的EC2、微软Azure、阿里云ECS、百度云、腾讯云等。云计算需要底层的虚拟化技术作为支撑，当前维基百科收录的就有超过60种虚拟化技术，其中基于X86体系的虚拟化超过50种，当然也有RISC体系的虚拟化，主要包括硬件虚拟化、操作系统层虚拟化、桌面虚拟化、应用程序虚拟化以及网络虚拟化等。从虚拟化的实现方式上可以划分为宿主架构和裸金属架构两种方式，其中宿主架构中虚拟机作为宿主操作系统的一个进程进行调度和管理，主要在个人的PC端应用较为广泛，如VirtualBox、VMware Workstation、WindowVirtual PC等。
裸金属架构则不需要主机操作系统，直接以Hypervisor运行于物理硬件上，主要应用于服务器的虚拟化。应用最为广泛的如微软的Hyper-V、VMWARE的ESX、开源的XEN和KVM等，云计算虚拟化架构中通常以虚拟机的方式提供给用户，用户根据自己的资源需求和软件服务申请合适的虚拟机进行服务，在进行大规模云计算环境构建时应选择合适的虚拟化架构方式，实现统一管理和跨平台的资源调度，综合利用各种虚拟化的性能优势。

在云计算中，资源的调度器对集群的性能和资源利用率起到决定性作用，是云计算的核心。传统虚拟机式的云计算集群对调度策略有相当多的研究~\cite{CloudSummarize}，主要集中在降低系统能耗、提高数据中心资源利用率、集群服务器的负载均衡以及基于成本模式的资源管理研究。文献~\inlinecite{Quang2013A}提出一种根据虚拟机负载动态调节处理器电压和频率来降低集群能耗；文献~\inlinecite{Beloglazov2012}通过动态分配云计算中心的虚拟机，减少服务器的数量来节约能耗；文献~\inlinecite{BalanceCenter}通过提出一种中心平衡器的平衡算法来实现集群服务器的负载均衡；文献~\inlinecite{Kumar2015A}将应用需求和物理机计算资源建模，基于蚁群算法、粒子群算法等迭代方式求解最佳分配策略，减少服务器的数量，提升集群资源利用率；文献~\inlinecite{Buyya2008Market}提出面向市场的体系结构和资源分配调度方法，该体系结构通过SLA资源分配器实现用户和服务商的协商，从而实现资源的优化配置。由此看出，在虚拟机式的云计算中，人们对云计算资源调度方法进行深入的研究，广泛应用于当前的云计算系统中，对推动云计算普及起到巨大的作用。

\section{容器云调度概述}
虚拟机是当前云计算的主要实现形式，也是云计算的核心技术之一，除了虚拟机，容器在云计算中应用越加广泛，容器云发展迅猛。当前容器虚拟技术以Docker为典型代表，Docker的底层实现是LXC(Linux Container)，LXC的资源管理完全依赖于内核的控制组(cgroups)。和传统的虚拟技术不同、LXC提供的虚拟环境是在操作系统层面实现的，主要面向进程，LXC提供的虚拟环境也就是容器，操作系统可以为容器分配各种CPU时间、I/O时间、内存等，并提供单独的命名空间。其隔离性主要依赖于Linux内核的namespace特性，命名空间让进程之间彼此隔离，这种既能与宿主机共享资源又能同时提供用户隔离的虚拟化方案迅速受到人们关注。容器虚拟化技术可以实现较小的虚拟化开销，应用可以实现快速的部署、交付以及较好的跨平台性。以Docker为基础构建的CaaS(Container as a Service)应运而生~\cite{Kozhirbayev2017A}，各大互联网公司投入巨资进行研发，根据451 Research预测，容器作为一种高速成长型的工具，年增幅高达40\%。容器将作为应用最为广泛的云工具，超过OpenStack、PaaS以及其他相关的产品，根据其预测，应用容器将从2016年的7.62亿美元增长到2020的27亿美元，其预测是根据125家应用容器厂商为基础做出的。容器的管理和调度市场也在进行快速的组合并购，Apprenda收购Kubernetes支持者Kismatic，思科收购Docker Swarm支持者ContainerX等，这些活动都加速了容器云的飞速发展，当前较为出色的有Google Container Engine、SAE、 Cloud Foundry、AWS ECS、Red Hat OpenShift等。

容器云和传统的以虚拟机与基础构建的云计算一样需要一个性能强大的容器编排管理器负责容器的调度、创建、销毁、监控、重启、错误恢复以及服务组合等工作，决定了容器云集群的性能和资源利用率，容器调度器同时也是推动容器迅速实现应用的重要因素。当前主要有三大主流的容器调度框架~\cite{Usman2016}: Docker Swarm、Apache Mesos以及Google Kubernetes，其中应用最为广泛的要属开源轻量，性能强大的Kubernetes。在调度算法上Swarm主要包括最少容器、最多容器和随机调度三种；Memsos侧重于负载均衡，更多使用传统的虚拟机调度方法，如DRF(Dominant Resource Fairness)实现资源分配；Kubernetes使用两阶段过滤评分选取最大评分的节点实现资源调度。几种调度方式和算法各有优缺点，用户可以根据自己的需求不同选取响应的容器调度框架构建不同的容器云计算环境，实现资源更好的分配和调度，本文主要对Kubernetes的调度方式进行研究，在大数据处理多种计算框架应用部署的情况下实现资源利用最大化和负载均衡，使应用的执行时间更短。

\section{论文主要工作和结构安排}
\subsection{论文的主要工作}
基于Docker容器虚拟化技术的PasS层OpenShift容器云平台使用Kubernetes进行容器管理和调度，该调度方式通过预选和优选两阶段选取评分最优的节点作为容器调度的目标，在优选阶段仅考虑内存和CPU的影响因素。本文针对其调度方式造成的资源利用率较低和负载不均衡的缺点，设计和实现了一个基于数学方法FAHP集群资源建模和参数自动求解的调度器，主要工作如下:
 \begin{enumerate}[(1)]
 \item 基于开源的OpenShift Origin和实验室项目Paladin Storage构建大数据存储与处理容器云平台Paladin，在该平台上开发Hadoop、Spark、MPI、Storm等十多种分布式处理框架，用户可以快速构建大数据处理框架和容器伸缩。
\item 深入研究Kubernetes调度核心技术，针对其调度算法不足，提出了一种基于多维资源空闲率权重的评价函数和调度方法MRWS(Multidimensional Resource Weights Scheduling)。该方法综合考虑物理节点CPU、内存、磁盘、网络带宽空闲率和已部署的容器应用个数等因素影响，使用模糊层次分析法FAHP(Fuzzy Analytic Hierarchy Process)对集群资源自动建模并求解容器应用多维资源权重参数，选取最大评分节点进行容器调度。
\item 针对MRWS调度策略，在容器云仿真平台ContainerCloudSim上进行大规模调度仿真，并与Random、FirstFit、Kubernetes默认调度策略在资源利用率和负载均衡性方面进行对比。
\item 在Paladin上设计并实现MRWS调度策略，针对多计算框架下大数据处理场景，比较MRWS与其他调度策略下的集群性能。新的调度策略无论在单计算框架容器应用还是多计算框架容器应用混合执行效率都有极大的提升。
\end{enumerate}

\subsection{本文结构安排}
本文总共分为六个章节，
第一章主要阐述传统虚拟机技术构建的云计算和新兴Docker容器技术构建的容器云，云计算底层虚拟化技术的基本架构、典型的云计算服务和云计算中资源调度器方法。接着介绍容器云底层的容器虚拟化技术支撑，代表性的容器云服务以及三大主流的容器编排器，进而引出Kubernetes容器编排器的不足和本文需要研究解决的问题。
第二章首先对比Docker容器虚拟化技术和传统虚拟机技术以及Docker构建的容器云平台，接着比较分析容器云中三种主要的调度系统，最后针对Kubernetes容器编排管理器的组织架构、调度流程和原理以及其调度的不足进行深入分析。
第三章针对Kubernetes调度器不足，设计一种新的调度方法和调度流程，新的调度方案充分考虑容器应用特点和集群物理资源的特点，主要包括其调度流程、多维资源建模、反馈器的设计以及全新的评价函数构建。
第四章使用FAHP方法解决法解决新的调度方案中多维资源权重的问题，对应用和集群资源进行数学建模、自动构满足一致性要求的建模糊成对比矩阵和判断矩阵，自动求解应用资源权重参数。
第五章首先使用ContainerCloudSim进行仿真环境的搭建，对比分析新的调度方法和Kubernetes默认调度方案、FirstFit和Random调度方法在集群资源利用率、负载均衡性方面的性能。然后在实验室大数据存储与处理容器云平台Paladin上开发部署十几种分布式计算框架，将新的调度方案应用于Paladin中，在大数据处理的多计算框架下进行性能测试。最后一章对本文工作进行总结，展望未来的研究方向。

